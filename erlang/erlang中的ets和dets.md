#Erlang中的ETS和DETS
======
#关于ETS和DETS
======
ETS和DETS是两个系统模块，可以用来高效存储海量Erlang数据。ETS是Erlang Term Storage（Erlang数据存储）的缩写。DETS则是Disk ETS（磁盘ETS）的缩写。

两者执行的任务基本相同：提供大型的键值查询表。ETS和DETS表可以被多个进程共享，这就让跨进程的公共数据访问变得非常高效。

#表的类型
=====
基本的表类型：异键表（表里所有的键都是唯一的）、同键表（允许多个元素拥有相同的键）、有序异键、副本同键。

#四种基本操作
======
* 创建或打开现有表：ets:new或dets:open_file
* 插入一个或多个元组：insert(TableID, X)。其中X是一个元组或元组列表。
* 表中查找元素：lookup(TableID, Key)
* 丢弃某个表：dets:close(TableID)或etd:delete(TableID)

#影响ETS表的效率因素
======
ETS表在内部是用散列表示的（有序异键表使用平衡二叉树表示）。这意味着使用异键表会来带少许空间开销，而使用有序异键表会带来时间开销。插入异键表所需的时间是恒定的，而插入有序异键表所需的时间和表内条目数量的对数成比例。

ETS表保存在一个单独的存储区域里，与正常的进程内存无关。可以认为ETS表归创建它的进程所有，当这个进程挂了或ets:delete后，表会被删除。

当一个元组被插入ETS表时，所有代表这个元组的数据结构都会从进程的栈复制到ETS表里。当对表执行查询操作时，找到的元组会从ETS表复制到进程的栈上。

所有的数据结构都是如此，除了大型的二进制数据。这些二进制型会存储在它们自己的堆外存储区域里。这个区域可以被多个进程和ETS表共享。各个二进制型则由一个引用计数垃圾收集器管理，它会记录有多少个不同的进程和ETS表在使用这个二进制型。当计数为0，该存储区域就可以被回收。

因此，在进程间传递包含大型二进制数据的消息非常高效，向ETS表插入包含二进制型的元组也非常高效。经验法则：尽可能多用二进制型来表示字符串和大块的无类型内存。










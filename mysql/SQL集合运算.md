title: SQL集合运算
date: 2016-08-12 10:55:00
tags:
- sql
- union
- interset
- except

# SQL集合运算

## 简介

集合运算包含3种：

1. 并集运算
2. 交集运算
3. 差集运算

为什么使用集合运算：

* 在集合运算中比联接查询和EXISTS/NOT EXISTS更方便
* 在将不同查询结果集组合为一个结果集
* 不同于 join，集合运算要求结果集之间的行匹配

## 语法

	输入的查询1
	
	集合运算符>
	
	输入的查询2
	
	[ORDER BY]

## 要求

* 输入的查询不能包含ORDER BY字句；
* 可以为整个集合运算结果选择性地增加一个ORDER BY字句；
* 每个单独的查询可以包含所有逻辑查询处理阶段（处理控制排列顺序的ORDER BY字句）；
* 两个查询 必须包含相同的列数；
* 每个单独的查询可以包含所有逻辑查询处理阶段（处理控制排列顺序的ORDER BY字句）；
* 两个查询 必须包含相同的列数；
* 相应列必须具有兼容的数据类型。

	兼容的数据类型：优先级较低的数据类型必须能隐式地转换为较高级的数据类型。比如输入的查询1的第一列为int类型，输入的查询2的第一列为float类型，则较低的数据类型int类型可以隐式地转换为较高级float类型。如果输入的查询1的第一列为char类型，输入的查询2的第一列为datetime类型，则会提示转换失败：从字符串转换日期和/或时间时，转换失败；

* 集合运算结果中列名由输入的查询1决定，如果要为结果分配结果列，应该在输入的查询1中分配相应的别名；
* 集合运算时，对行进行比较时，集合运算认为两个NULL相等；	
* UNION支持DISTINCT和ALL。不能显示指定DISTINCT字句，如果不指定ALL，则默认使用DISTINCT
* INTERSET和EXCEPT默认使用DISTINCT，不支持ALL



## 参考

* [详解 SQL 集合运算](http://blog.jobbole.com/104452/)
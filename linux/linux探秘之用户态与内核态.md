title: linux探秘之用户态与内核态
date: 2016-05-23 21:51:00
tags:
- linux

# linux探秘之用户态与内核态

文章[Linux探秘之用户态与内核态](http://www.cnblogs.com/bakari/p/5520860.html)写得挺简洁的。学习之：

## 概述

* Linux操作系统的体系架构分为用户态和内核态（或者用户空间和内核）。**内核从本质上看是一种软件——控制计算机的硬件资源，并提供上层应用程序运行的环境**。用户态即上层应用程序的活动空间，应用程序的执行必须依托于内核提供的资源，包括CPU资源、存储资源、I/O资源等。为了使上层应用能够访问到这些资源，内核必须为上层应用提供访问的接口：即系统调用。
* `系统调用`是操作系统的最小功能单位。可以把系统调用看成是一种不能再化简的操作（类似于原子操作，但是不同概念）。很多功能需要通过多个系统调用才能完成，为减轻程序编写的复杂，通过对系统调用的进行封装，这就是`库函数`
* `Shell`是一个特殊的应用程序，俗称命令行，本质上是一个命令解释器，它下通系统调用，上通各种应用，通常充当着一种“胶水”的角色，来连接各个小功能程序，让不同程序能够以一个清晰的接口协同工作，从而增强各个程序的功能。同时，Shell是可编程的，它可以执行符合Shell语法的文本，这样的文本称为Shell脚本

总结一下，用户态的应用程序可以通过三种方式来访问内核态的资源：

1. 系统调用
2. 库函数
3. Shell脚本

## 用户态和内核态的切换

因为操作系统的资源是有限的，如果访问资源的操作过多，必然会消耗过多的资源，而且如果不对这些操作加以区分，很可能造成资源访问的冲突。所以，为了减少有限资源的访问和使用冲突，Unix/Linux的设计哲学之一就是：对不同的操作赋予不同的执行等级，就是所谓特权的概念。

Linux操作系统中主要采用了0和3两个特权级，分别对应的就是内核态和用户态。运行于用户态的进程可以执行的操作和访问的资源都会受到极大的限制，而运行在内核态的进程则可以执行任何操作并且在资源的使用上没有限制。很多程序开始时运行于用户态，但在执行的过程中，**一些操作需要在内核权限下才能执行，这就涉及到一个从用户态切换到内核态的过程**。

到底在什么情况下会发生从用户态到内核态的切换，一般存在以下三种情况：

1. 当然就是系统调用：原因如上的分析。
2. 异常事件： 当CPU正在执行运行在用户态的程序时，突然发生某些预先不可知的异常事件，这个时候就会触发从当前用户态执行的进程转向内核态执行相关的异常事件，典型的如缺页异常。
3. 外围设备的中断：当外围设备完成用户的请求操作后，会像CPU发出中断信号，此时，CPU就会暂停执行下一条即将要执行的指令，转而去执行中断信号对应的处理程序，如果先前执行的指令是在用户态下，则自然就发生从用户态到内核态的转换。


注意：**系统调用的本质其实也是中断，相对于外围设备的硬中断，这种中断称为软中断**，这是操作系统为用户特别开放的一种中断，如Linux int 80h中断。所以，**从触发方式和效果上来看，这三种切换方式是完全一样的，都相当于是执行了一个中断响应的过程**。但是从触发的对象来看，系统调用是进程主动请求切换的，而异常和硬中断则是被动的。






## 参考

* [Linux探秘之用户态与内核态](http://www.cnblogs.com/bakari/p/5520860.html)
title: 分布式简介
date: 2016-05-20 12:19:00
tags:
- distributed
- cluster

# 分布式简介

## 分布式和集群

* 集群

	某个服务（如单机版搜索引擎）由于请求量非常巨大，QPS单机已经扛不住了，于是我们把这个单机版的变成前面用一个nginx做负载均衡，后面挂N多搜索服务，这不叫分布式，这是集群。
	
* 分布式

	当我们发现由于排序算法变复杂了，或者数据量增多了，每次返回数据的时间由10ms变成500ms了，这个时候只能把服务给拆成多个服务才能满足业务需求了，这才叫分布式
	
所以说，一般情况下，集群就已经够用了，需要进行分布式的服务其实并不多，而且集群基本上都是高可用的，风险也小，所以除非迫不得已，没有必要为了分布式而分布式，这叫过度设计，单机其实挺好的，简单易维护，抗造高可用。

## 分布式设计

一般一个服务要进行分布式的设计，会从两个方面进行。

* 一是服务的功能分布式，对应到代码也就是把一个1000行的函数变成两个500行的函数。
* 二是数据的分布式，就是数据已经太多了，单节点已经放不下了，或者单节点处理这么多数据能力已经不够了，那也得进行分布式，数据分布式其实大家见得多了，分库分表就是一种数据分布式。	

### 服务功能的分布式拆分

对于分布式的服务，一般需要注意以下三个关键点：

* 尽量减少网络开销

	一个分布式服务，应该尽量的减少网络通讯上的开销，分布式的初衷是将计算能力分布到多个节点上而提高整体的响应时间，如果在网络通讯上花费了很多的开销，反而会使响应时间增长而违背了设计的初衷。
	
* 各个子服务应该是无状态的

	如果是分布式服务中的一个子服务，它应该尽量设计成无状态的，放到编程语言上来说就是说这个服务应该是一个纯函数的服务，一个输入只会有一个输出，不会因为不同的状态产生不同的输出，这样主要是为了方便调用，调用服务的时候不需要去考虑状态。如果一定需要状态的话（比如用户的会话状态session），对于分布式服务，一般会将状态单独存储在某个位置（比如redis中），需要的时候去取就行了，服务本身并不保存这个状态。
	
* 每个子服务都应该是可横向扩展的

	虽然上面我们说了集群和分布式的区别，但是分布式的系统一般都得能满足集群的部署，如果每个子服务能满足无状态的话，那么横向扩展就没什么问题了，因为无状态，所以对外来说每台机器都是一样的，调用谁结果都一样，自然就能横向扩展了。
	
### 数据的分布式拆分

服务已经进行了拆分，已经算是一个分布式系统了，但是随着搜索引擎的数据越来越多，单机的性能也会达到一个极限，比如五亿条数据，单机基本上比较难抗住了（如果你硬要上一台1T内存，100T硬盘，64CPU的机器，那是你任性），所以这时候的分布式就是需要进行数据层面的分布式设计了。

数据的拆分和服务的拆分的本质区别，要考虑的地方也不一样，服务说白了就是一堆函数，不会变化，拆到哪里都是一样的，横向扩展完全没问题，而数据是会变的，如何拆分数据不是数据分布式的重点，数据拆分需要解决的最重要的问题就是：如何保证各个相同节点的数据强一致性。这也是所有的分布式系统需要的最重要的问题，才会为了这个出现那么多一致性的理论。

		
	





## 参考

* [分布式搜索引擎设计](https://segmentfault.com/a/1190000005161923)
#防止用户重复登录

##需求
一个账号只能登录一次，不能重复登录问题。

##分析
* 如果该用户登录了 则无法再次登陆该用户。
* 关闭浏览器 或者电脑意外断电 程序将该用户退出
* 点退出按钮 程序将该用户退出
* 如果A帐户登录了，则不管是同个机子，还是其他机子，都不能再登录A帐户（用普通Session的话，大家都知道重新开一个浏览器，同个机子 还是可以同时登录2个一样的帐户的）

##解决方案

大概有两种解决方案：

1. 通过数据库状态位判断该用户是否已经登录。
2. 利用session监听器监听每一个登录用户的登录情况，并维护在线列表（已登录用户）

第一种解决方案很简单，但需要考虑用户非正常退出的情况，如直接关闭浏览器等等，可用性较低。

第二种方案：

1. 登录时

	用户登录后，先去在线列表查询该登录名是否存在、是否锁定，在登录名存在且非锁定的情况下，从application内置作用域对象中取出所有的登录信息，查看该登录名是否已经登录，如果登录了，就友好提示下；反之表示可以登录，将该登录信息保存在application中。

2. 退出

	用户正常退出时，我们需要将该用户的登录信息从session中移除。我们可以写一个Session监听器，监听sessioon销毁的时候，我们将登录的用户注销掉，也就是从application中移除。表示该用户已经下线了，将在线列表对应数据删除
	
3. 非正常退出。

	用户突然关闭了浏览器而没有点击退出按钮，可以利用onunload事件
	
	

##扩展

* 需求为：新登录挤掉后登录的人

> 关于重复登录的问题，可以将登录后的用户设为在线状态，此状态下不允许再登录。但这种方案有一个严重的缺陷，就是如果用户登录后，没有正常注销，那下次就登不上了。服务器端做定时注销处理，也存在一个时间间隔问题。
> 
关于异常情况下用户注销问题，可以在浏览器的onunload事件里，使用Ajax异步到服务器端请求注销。这可以解决用户直接关浏览器的情况，但对诸如客户端断电、网络中断等还是无能为力。B/S下此问题似乎没有找到完美的解决方案。

> 综合上面两种情况，我的解决方案是，在服务端维护登录用户与其SessionID的关系。同一用户，后登陆者将前登陆者的SessionID冲掉，这样，前者如果再请求服务器资源，就会认为其未登录，要求重新登录。这样，即使出现断电等无法注销的情况，也会在他下次登陆时自动取代掉，同时也解决了用户登陆的唯一性问题。

	
* 不同ip登录

	在存储 UserID的时候，将UserID+客户端IP地址一起存进去，则在将相应信息取出来分析的时候，可以做到：当用户在不同的计算机上先后登录的时候，则允许最近一 次的登录，而将之前的登录删除！等等等等
	
	








